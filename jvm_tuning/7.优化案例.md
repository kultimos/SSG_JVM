# 调优案例

## 调整堆大小提升服务的吞吐量
  - 核心的改良是通过提升内存,减少了fullGC的次数,所以整个性能更好,吞吐量更高

## 合理配置堆内存
  ### 官方给出了原则,依赖于Java Performance里面的推荐公式来进行设计
  - java整个堆大小的设置,Xmx和Xms设置为老年代存货对象的3~4倍,即FullGC之后的老年代内存占用的3-4倍
  - 方法区(永久代或元空间),应该设置为老年代存活对象的1.2~1.5倍
  - 年轻代的Xmn应该设置为老年代存活对象的1~1.5倍
 
  ### 那么如何获悉老年代的存活对象占据内存空间的大小呢？
  - JVM参数中增加GC文件,根据多次FullGC之后的内存大小取平均值
  - 强制触发FullGC,来观察老年代存活对象的大小;可以通过JConsole、VisualVM去手动触发FullGC

## ※※※ 很高的排查方案※※※※※
  ### 排查流程
  - top -Hp <pid>, 显示该进程的线程信息  或者 ps aux | grep java, 显示所有的java进程的详细信息
  基于该命令,获悉可能出现问题的线程id,在通过后面的线程堆栈信息来确定具体出现问题的原因和对应的源代码位置
  - jstack <进程id> > jstack.log, 将该进程下的各个线程的堆栈信息打印到指定的log文件下


## 调整垃圾回收器提高服务的吞吐量
  - 如果系统配置是单核,我们看到日志,显示DefNew,说明我们用的是串行收集器,SerialGC
  - 